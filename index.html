<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>Klokah éŸ³æª”ä¸‹è¼‰å™¨</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f4f4f4; }
    input, button { padding: 8px; margin: 10px 0; }
    .sentence-block { background: white; padding: 10px; border-radius: 8px; margin-bottom: 10px; }
    audio { display: block; margin-top: 8px; }
    .zip-link { margin-top: 20px; font-weight: bold; }
  </style>
</head>
<body>
  <h1>Klokah éŸ³æª”ä¸‹è¼‰å·¥å…·</h1>
  <p>è«‹è¼¸å…¥ klokah èªæ–™ç¶²å€ï¼Œä¾‹å¦‚ï¼šhttps://web.klokah.tw/text/read.php?tid=8030</p>
  <input type="text" id="url" size="60" placeholder="è«‹è¼¸å…¥ klokah ç¶²å€">
  <button id="fetch">æ“·å–éŸ³æª”</button>
  <div id="results"></div>

  <script>
    $('#fetch').click(async function () {
      const url = $('#url').val();
      if (!url.includes('klokah')) return alert('è«‹è¼¸å…¥ klokah ç¶²å€');
      const tidMatch = url.match(/tid=(\d+)/);
      if (!tidMatch) return alert('ç¶²å€ä¸­æ‰¾ä¸åˆ° tid');
      const tid = tidMatch[1];
      const proxyUrl = `https://corsproxy.io/?${encodeURIComponent(url)}`;
      $('#results').html('è¼‰å…¥ä¸­...');

      try {
        const html = await $.get(proxyUrl);
        const page = $('<div>').html(html);

        const abList = page.find('.read-sentence.Ab');
        const chList = page.find('.read-sentence.Ch');
        const audioList = page.find('#audioSet audio source');
        let output = '';

        for (let i = 0; i < audioList.length; i++) {
          const mp3Url = $(audioList[i]).attr('src');
          const chText = $(chList[i]).text().trim();
          const abText = $(abList[i]).text().trim();

          output += `
            <div class="sentence-block">
              <b>${chText}</b><br>
              <i>${abText}</i>
              <audio controls src="${mp3Url}"></audio>
              <a href="${mp3Url}" download>ä¸‹è¼‰ MP3</a>
            </div>
          `;
        }

        const zipLink = page.find("a[href*='downloadZip.php']").attr('href');
        if (zipLink) {
          output += `<div class="zip-link">ğŸ‘‰ <a href="https://web.klokah.tw/${zipLink}" target="_blank">ä¸‹è¼‰å…¨éƒ¨éŸ³æª”ï¼ˆZIPï¼‰</a></div>`;
        }

        $('#results').html(output);
      } catch (err) {
        console.error(err);
        $('#results').html('âŒ ç„¡æ³•æ“·å–è©²é å…§å®¹ï¼Œè«‹ç¢ºèªç¶²å€æ˜¯å¦æ­£ç¢º');
      }
    });
  </script>
</body>
</html>
