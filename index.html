<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>KLOKAH éŸ³æª”ä¸‹è¼‰å·¥å…·</title>
</head>
<body>
  <h1>è¼¸å…¥ç¶²å€ï¼Œè‡ªå‹•æå–éŸ³æª”</h1>
  <input type="text" id="targetUrl" placeholder="è²¼ä¸Š klokah ç¶²å€">
  <button onclick="fetchAndShowLinks()">å–å¾—éŸ³æª”</button>

  <div id="result"></div>

  <script>
    async function fetchAndShowLinks() {
      const url = document.getElementById("targetUrl").value;
      const tidMatch = url.match(/tid=(\d+)/);
      const tid = tidMatch ? tidMatch[1] : null;

      if (!tid) return alert("ç„¡æ³•è§£æ tidï¼Œè«‹ç¢ºèªç¶²å€æ ¼å¼");

      const proxyUrl = `https://corsproxy.io/?${encodeURIComponent(url)}`;

      const res = await fetch(proxyUrl);
      const html = await res.text();

      const div = document.createElement("div");
      div.innerHTML = html;

      const audioTags = div.querySelectorAll("audio > source");
      const resultDiv = document.getElementById("result");
      resultDiv.innerHTML = `<h2>é€å¥ MP3 éŸ³æª” (${audioTags.length} ç­†)</h2>`;

      audioTags.forEach((el, i) => {
        const href = el.getAttribute("src");
        const name = href.split("/").pop();
        const a = document.createElement("a");
        a.href = href;
        a.download = name;
        a.innerText = `ä¸‹è¼‰ ${name}`;
        a.style.display = "block";
        resultDiv.appendChild(a);
      });

      const zipLink = div.querySelector(`a[href*='downloadZip.php?tid=${tid}']`);
      if (zipLink) {
        const a = document.createElement("a");
        a.href = `https://web.klokah.tw/text/php/downloadZip.php?tid=${tid}`;
        a.download = `tid_${tid}.zip`;
        a.innerText = "ğŸ”½ ä¸‹è¼‰æ•´åŒ… ZIP éŸ³æª”";
        a.style.display = "block";
        a.style.marginTop = "1em";
        resultDiv.appendChild(a);
      }
    }
  </script>
</body>
</html>
